var app=angular.module("alarmviewer",["ngTouch","ngAnimate","pascalprecht.translate"]);app.config(["$translateProvider",function(e){e.useStaticFilesLoader({prefix:"/locale/locale-",suffix:".json"}),e.preferredLanguage("fr")}]),app.run(["$rootScope","$timeout","$translate",function(e,t,n){e.changeLanguage=function(e){n.use(e)},e.getCurrentLanguage=function(){return n.use()},e.notification={message:"",show:!1,timeout:void 0,priority:0},e.sendnotification=function(n,r,i){e.notification.show&&e.notification.priority>i||(e.notification.timeout&&(t.cancel(e.notification.timeout),e.notification.timeout=void 0),e.notification.message=n,e.notification.priority=i,e.notification.show=!0,r&&(e.notification.timeout=t(function(){e.notification.show=!1,e.notification.timeout=void 0},5e3)))},e.hidenotification=function(){e.notification.show=!1,t.cancel(e.notification.timeout),e.notification.timeout=void 0},e.logHttpError=function(e){var t="Error : "+e.config.method+" "+e.config.url+"\nCode "+e.status+" - "+e.statusText+" : "+e.data;console.error(t)}}]),app.animation(".notif-animation",function(){return{addClass:function(e,t,n){e.scope();"ng-hide"==t?e.slideUp(n):n()},removeClass:function(e,t,n){e.scope();"ng-hide"==t?(e.removeClass("ng-hide"),e.slideDown(n)):n()}}});var tabletBreakpoint=992,mobileBreakpoint=768,viewportWidth=document.documentElement.clientWidth,device;device=viewportWidth<mobileBreakpoint?"mobile":viewportWidth<tabletBreakpoint?"tablet":"desktop",app.value("device",device),app.directive("spinner",function(){return{restrict:"E",replace:!0,template:'<div class="spinner">',link:function(e,t,n){var r={lines:12,length:12,corners:1,radius:12,rotate:0,direction:1,speed:1,trail:50,color:"red",opacity:.25,direction:1,speed:1},i=t[0];new Spinner(r).spin(i)}}});function LoadImages(e,t,n){if(t.hasOwnProperty("Images"))n();else{t.Images=[];for(var r=0,i=function(){++r==2*t.nbimages&&n()},o=0;o<t.nbimages;o++)t.Images[o]={Image:new Image},t.Images[o].Image.addEventListener("load",i),t.Images[o].Image.src="/controller/alarm/"+t.id+"/image/"+o+"/jpg",e.get("/controller/alarm/"+t.id+"/image/"+o+"/osd").success(function(e){return function(n){t.Images[e].OSD=n,i()}}(o)).error(i)}}app.factory("alarmevents",["$rootScope",function(e){var t=new EventSource("/events"),n=function(t){var n=null;try{n=JSON.parse(t.data)}catch(r){}n&&e.$apply(e.$emit.bind(e,t.type,n))};return t.addEventListener("alarm_create",n,!1),t.addEventListener("alarm_update",n,!1),t.addEventListener("alarm_deleted",n,!1),t.addEventListener("connection",n,!1),t}]),function(e){if(!("EventSource"in e)){var t=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,n=function(e){var n=this,i=500,o=null,a="";if(!e||"string"!=typeof e)throw new SyntaxError("Not enough arguments");this.URL=e,this.readyState=this.CONNECTING,this._pollTimer=null,this._xhr=null;function u(e){n._pollTimer=setTimeout(function(){c.call(n)},e)}function c(){try{if(n.readyState==n.CLOSED)return;var e=new XMLHttpRequest;e.open("GET",n.URL,!0),e.setRequestHeader("Accept","text/event-stream"),e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),null!=o&&e.setRequestHeader("Last-Event-ID",o),a="",e.timeout=5e4,e.onreadystatechange=function(){if(3==this.readyState||4==this.readyState&&200==this.status){n.readyState==n.CONNECTING&&(n.readyState=n.OPEN,n.dispatchEvent("open",{type:"open"}));var e="";try{e=this.responseText||""}catch(c){}var s=e.substr(a.length).split("\n"),l="message",f=[],d=0,p="";for(a=e;d<s.length;d++)if(p=s[d].replace(t,""),0==p.indexOf("event"))l=p.replace(/event:?\s*/,"");else if(0==p.indexOf("retry"))retry=parseInt(p.replace(/retry:?\s*/,"")),isNaN(retry)||(i=retry);else if(0==p.indexOf("data"))f.push(p.replace(/data:?\s*/,""));else if(0==p.indexOf("id:"))o=p.replace(/id:?\s*/,"");else if(0==p.indexOf("id"))o=null;else if(""==p&&f.length){var h=new r(f.join("\n"),n.url,o);n.dispatchEvent(l,h),f=[],l="message"}4==this.readyState&&u(i)}else n.readyState!==n.CLOSED&&(4==this.readyState?(n.readyState=n.CONNECTING,n.dispatchEvent("error",{type:"error"}),u(i)):0==this.readyState&&u(i))},e.send(),setTimeout(function(){e.abort()},e.timeout),n._xhr=e}catch(c){n.dispatchEvent("error",{type:"error",data:c.message})}}c()};n.prototype={close:function(){this.readyState=this.CLOSED,clearInterval(this._pollTimer),this._xhr.abort()},CONNECTING:0,OPEN:1,CLOSED:2,dispatchEvent:function(e,t){var n=this["_"+e+"Handlers"];if(n)for(var r=0;r<n.length;r++)n[r].call(this,t);this["on"+e]&&this["on"+e].call(this,t)},addEventListener:function(e,t){this["_"+e+"Handlers"]||(this["_"+e+"Handlers"]=[]),this["_"+e+"Handlers"].push(t)},removeEventListener:function(e,t){var n=this["_"+e+"Handlers"];if(n)for(var r=n.length-1;r>=0;--r)if(n[r]===t){n.splice(r,1);break}},onerror:null,onmessage:null,onopen:null,readyState:0,URL:""};var r=function(e,t,n){this.data=e,this.origin=t,this.lastEventId=n||""};r.prototype={data:null,type:"message",lastEventId:"",origin:""},"module"in e&&(module.exports=n),e.EventSource=n}}(this),app.controller("accountController",["$scope","$rootScope","$window","device","userdb",function(e,t,n,r,i){e.device=r,e.showMenu=!0,e.user={},e.password={old:"","new":"",confirm:""},e.tab="loginForm",i.getCurrentUser(function(t){e.user=t.data},function(t){e.logHttpError(t),e.sendnotification("Impossible d'obtenir vos informations.",!1,1)}),e.commituser=function(){i.updateDisplayName(e.user.displayname,function(t){e.sendnotification("Votre nom a été changé",!0,1)},function(t){e.sendnotification("Une erreur s'est produite lors de l'enregistrement de vos informations",!1,1),e.logHttpError(t)})},e.changepassword=function(){e.password["new"]===e.password.confirm?i.changePassword(e.password.old,e.password["new"],function(t){e.sendnotification("Votre mot de passe a été changé",!0,1)},function(t){401===t.status?e.sendnotification("Le mot de passe saisi est incorrect",!1,1):e.sendnotification("Une erreur s'est produite lors de l'enregistrement de votre nouveau mot de passe.",!1,1),e.logHttpError(t)}):e.sendnotification("Les champs nouveau mot de passe et confirmation doivent correspondre",!1,1)}}]),app.factory("alarmdb",["$http","$rootScope",function(e,t){var n={};return n.getSiteList=function(t){e.get("/controller/alarms/sitelist").success(t).error(function(){t(null)})},n.getCameraList=function(t){e.get("/controller/alarms/cameralist").success(t).error(function(){t(null)})},n.getAlarms=function(t,n){var r="?";r+="date="+t.date.getTime()/1e3,"Tous"!==t.sitename&&(r+="&sitename="+t.sitename.replace(" ","%20"),"Toutes"!==t.camera&&(r+="&cameraname="+t.camera.replace(" ","%20"))),console.log("Request : /controller/alarms"+r),e.get("/controller/alarms"+r).success(n).error(function(){n(null)})},n.getNotHandledAlarms=function(t){e.get("/controller/alarms/nothandled").success(t).error(function(){t(null)})},n.markashandled=function(t,n){e.put("/controller/alarm/"+t+"/markashandled").success(n).error(function(e){n({response:e})})},n}]),app.controller("tabcontroller",["$scope",function(e){e.tab="notHandled"}]),app.controller("alarmcontroller",["$scope","$rootScope","$window","alarmdb","alarmevents","device","$window","$translate",function(e,t,n,r,i,o,n,a){e.device=o,e.sortType="timestamp",e.sortReverse=!0,e.currentalarm=void 0,e.selected=[],e.isSelectedAll=!1,e.loading=!0,e.limit=20,e.limitStep=20,e.showmorealarms=function(){e.limit+=e.limitStep};var u=new Date;u.setHours(0,0,0,0),e.debug="",r.getSiteList(function(t){e.sites=["Tous"].concat(t),console.log("Liste des serveurs :",e.sites)}),e.cameras=[{cameraname:"Toutes",sitename:"all"}],r.getCameraList(function(t){e.debug+="Liste des caméras "+(new Date).getTime(),e.cameras=e.cameras.concat(t)}),e.filters={sitename:"Tous",camera:"Toutes",date:u},e.currentfilters=angular.copy(e.filters),e.$watch("filters.sitename",function(t,n){t!==n&&(e.filters.camera="Toutes")}),e.applyfilters=function(){e.loading=!0,e.limit=30,e.currentalarm=void 0,e.currentfilters=angular.copy(e.filters),r.getAlarms(e.filters,function(t){e.alarms=t,e.loading=!1})},e.resetfilters=function(){e.showfilters=!1,e.filters=angular.copy(e.currentfilters)},e.cancelTabWatcher=e.$watch("tabName",function(t,n){e.getAlarms()}),e.getAlarms=function(){"notHandled"===e.tabName?r.getNotHandledAlarms(function(t){e.alarms=t,e.loading=!1}):"filteredAlarms"===e.tabName&&r.getAlarms(e.filters,function(t){e.alarms=t,e.loading=!1}),e.cancelTabWatcher()},e.playalarm=function(t){e.showfilters=!1,e.resetfilters();var n=e.alarms.map(function(e){return e.id}).indexOf(t),r=n==-1?void 0:e.alarms[n];e.currentalarm=r},e.markashandled=function(t,i){if(void 0!==e.currentalarm&&e.currentalarm.id==t||n.confirm("Voulez-vous vraiment acquitter cette alarme ?")){if(void 0!==e.currentalarm&&e.currentalarm.id==t){var o=e.getPreviousAlarm();o!==-1?e.currentalarm=e.alarms[o]:e.currentalarm=void 0}r.markashandled(t,function(e){})}i.stopPropagation()},e.markcurrentashandled=function(t){e.markashandled(e.currentalarm.id,t)},e.shownextalarm=function(){var t=e.getNextAlarm();if(t!==-1){var n=e.alarms[t].id;e.playalarm(n)}},e.showpreviousalarm=function(){var t=e.getPreviousAlarm();if(t!==-1){var n=e.alarms[t].id;e.playalarm(n)}},e.getNextAlarm=function(){var t=e.alarms;if(t.length<2)return-1;var n=t.map(function(e){return e.id}).indexOf(e.currentalarm.id);return n===t.length-1?0:n+1},e.getPreviousAlarm=function(){var t=e.alarms;if(t.length<2)return-1;var n=t.map(function(e){return e.id}).indexOf(e.currentalarm.id);return 0===n?t.length-1:n-1},e.handleSelected=function(){window.confirm("Voulez-vous vraiment acquitter ces "+e.selected.length+" alarmes ?")&&e.selected.forEach(function(e){r.markashandled(e,function(e){})})},e.handleall=function(t){var n=[];e.alarms.forEach(function(e){n.push(e)}),window.confirm("Êtes vous sûr de vouloir acquitter toutes les alarmes ?")&&(n.forEach(function(e){r.markashandled(e.id,function(e){})}),e.currentalarm=void 0)},e["delete"]=function(t){(void 0!=e.currentalarm&&e.currentalarm.id==t||n.confirm("Êtes-vous sûr de vouloir acquiter cette alarme ??"))&&r["delete"](t,function(e){})},e.isSelected=function(t){return e.selected.indexOf(t)>=0},e.updateSelection=function(t,n){n.stopPropagation(),e.isSelected(t)?(e.selected.splice(e.selected.indexOf(t),1),e.isSelectedAll&&(e.isSelectedAll=!1)):(e.selected.push(t),e.selected.length===e.alarms.length&&(e.isSelectedAll=!0))},e.selectall=function(){e.isSelectedAll?e.selected=[]:e.alarms.forEach(function(t){e.selected.indexOf(t.id)<0&&e.selected.push(t.id)}),e.isSelectedAll=!e.isSelectedAll},e.camerasForCurrentSite=function(t){return t.sitename===e.filters.sitename||"all"===t.sitename},e.getNotHandledAlarms=function(){return e.alarms?e.alarms.filter(function(e){return 0===e.handled}):[]};var c=function(t,r){var i=e.alarms.map(function(e){return e.id}).indexOf(r.id);i>=0?(void 0!==e.currentalarm&&e.currentalarm.id==r.id&&0!=r.handled&&(n.alert("L'alarme sélectionnée a été acquitée."),e.currentalarm=void 0),0!=r.handled&&e.sendnotification("Alarme acquittée",!0,1),e.alarms[i]=r,e.selected.indexOf(r.id)>=0&&e.selected.splice(e.selected.indexOf(r.id),1)):(e.limit++,"notHandled"===e.tabName&&e.alarms.push(r))},s=t.$on("alarm_create",c),l=t.$on("alarm_update",c);e.$on("$destroy",function(){s(),l()})}]),app.directive("swiper",function(){return{templateUrl:"/swiper",restrict:"E",replace:!0}}),app.directive("imagewithosd",function(){return{restrict:"E",scope:{image:"=",osd:"="},replace:!0,template:'<canvas class="imagecanvas"/>',link:function(e,t,n){var r=t[0];r.setAttribute("width",800),r.setAttribute("height",600);function i(){if(e.image&&e.image.naturalWidth&&e.image.naturalWidth>0&&e.image.naturalHeight>0){var t=r.getContext("2d");t.width=800,t.height=600;var n=t.width/e.image.naturalWidth,i=t.height/e.image.naturalHeight,o=Math.min(n,i),a=(t.width-e.image.naturalWidth*o)/2,u=(t.height-e.image.naturalHeight*o)/2;if(t.clearRect(0,0,r.width,r.height),t.drawImage(e.image,0,0,e.image.naturalWidth,e.image.naturalHeight,a,u,e.image.naturalWidth*o,e.image.naturalHeight*o),e.osd)for(var c=0;c<e.osd.length;c++){var s=e.osd[c];t.lineWidth="2",t.strokeStyle="red",t.beginPath(),t.moveTo(s[0].x*r.width/e.image.width,s[0].y*r.height/e.image.height);for(var l=0;l<s.length;l++)t.lineTo(s[l].x*r.width/e.image.width,s[l].y*r.height/e.image.height);t.closePath(),t.stroke()}}}e.$watch("image",function(e,t){i()}),e.$watch("osd",function(e,t){i()})}}}),app.directive("imageplayer",["$http","$interval","$timeout",function(e,t,n){return{restrict:"E",scope:{alarm:"=",imgwidth:"@",imgheight:"@"},replace:!0,templateUrl:"/imageplayer",link:function(r,i,o){r.rootElement=i,r.loading=!1,r.currentIdx=0,r.showOsd=!0,r.playing=!1,r.showcontrols=!0,r.interval,r.toggleOsd=function(){r.showOsd=!r.showOsd},r.nextImage=function(){r.alarm&&r.alarm.nbimages&&(r.currentIdx=(r.currentIdx+1)%r.alarm.nbimages)},r.prevImage=function(){r.alarm&&r.alarm.nbimages&&(r.currentIdx=(r.currentIdx-1+r.alarm.nbimages)%r.alarm.nbimages)},r.$watch("playing",function(e,n){e!==n&&(e?r.interval=t(function(){r.nextImage()},500):t.cancel(r.interval))}),r.$watch("alarm",function(t,i){t!==i&&t&&(r.playing=!1,r.loading=!0,console.log("Loading images"),LoadImages(e,t,function(){n(function(){r.loading=!1,r.playing=!0,r.currentIdx=0},0)}))})}}}]),app.factory("appstate",function(){var e={};return e.saveState=function(e,t){localStorage.setItem(e,t)},e.getState=function(e){return parseInt(localStorage.getItem(e))},e}),!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.async=e.async||{})}(this,function(e){"use strict";function t(e,t,n){var r=n.length;switch(r){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function n(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function r(e){var t=n(e)?pn.call(e):"";return t==ln||t==fn}function i(e){return!!e&&"object"==typeof e}function o(e){return"symbol"==typeof e||i(e)&&mn.call(e)==hn}function a(e){if("number"==typeof e)return e;if(o(e))return gn;if(n(e)){var t=r(e.valueOf)?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(yn,"");var i=wn.test(e);return i||_n.test(e)?Sn(e.slice(2),i?2:8):bn.test(e)?gn:+e}function u(e){if(!e)return 0===e?e:0;if(e=a(e),e===jn||e===-jn){var t=0>e?-1:1;return t*En}return e===e?e:0}function c(e){var t=u(e),n=t%1;return t===t?n?t-n:t:0}function s(e,n){if("function"!=typeof e)throw new TypeError(On);return n=xn(void 0===n?e.length-1:c(n),0),function(){for(var r=arguments,i=-1,o=xn(r.length-n,0),a=Array(o);++i<o;)a[i]=r[n+i];switch(n){case 0:return e.call(this,a);case 1:return e.call(this,r[0],a);case 2:return e.call(this,r[0],r[1],a)}var u=Array(n+1);for(i=-1;++i<n;)u[i]=r[i];return u[n]=a,t(e,this,u)}}function l(e){return s(function(t){var n=t.pop();e.call(this,t,n)})}function f(e){return s(function(t,n){var r=l(function(n,r){var i=this;return e(t,function(e,t){e.apply(i,n.concat([t]))},r)});return n.length?r.apply(this,n):r})}function d(){}function p(e){return function(){if(null!==e){var t=e;e=null,t.apply(this,arguments)}}}function h(e){return function(t){return null==t?void 0:t[e]}}function v(e){return"number"==typeof e&&e>-1&&e%1==0&&$n>=e}function m(e){return null!=e&&v(Ln(e))&&!r(e)}function g(e){return kn&&e[kn]&&e[kn]()}function y(e){return An(Object(e))}function b(e,t){return Cn.call(e,t)||"object"==typeof e&&t in e&&null===y(e)}function w(e){return Tn(Object(e))}function _(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function S(e){return i(e)&&m(e)}function j(e){return S(e)&&Un.call(e,"callee")&&(!Rn.call(e,"callee")||Pn.call(e)==Nn)}function E(e){return"string"==typeof e||!Wn(e)&&i(e)&&Dn.call(e)==Mn}function O(e){var t=e?e.length:void 0;return v(t)&&(Wn(e)||E(e)||j(e))?_(t,String):null}function x(e,t){return t=null==t?qn:t,!!t&&("number"==typeof e||Bn.test(e))&&e>-1&&e%1==0&&t>e}function L(e){var t=e&&e.constructor,n="function"==typeof t&&t.prototype||Fn;return e===n}function $(e){var t=L(e);if(!t&&!m(e))return w(e);var n=O(e),r=!!n,i=n||[],o=i.length;for(var a in e)!b(e,a)||r&&("length"==a||x(a,o))||t&&"constructor"==a||i.push(a);return i}function k(e){var t,n=-1;if(m(e))return t=e.length,function(){return n++,t>n?{value:e[n],key:n}:null};var r=g(e);if(r)return function(){var e=r.next();return e.done?null:(n++,{value:e.value,key:n})};var i=$(e);return t=i.length,function(){n++;var r=i[n];return t>n?{value:e[r],key:r}:null}}function A(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}function I(e){return function(t,n,r){r=p(r||d),t=t||[];var i=k(t);if(0>=e)return r(null);var o=!1,a=0,u=!1;!function c(){if(o&&0>=a)return r(null);for(;e>a&&!u;){var t=i();if(null===t)return o=!0,void(0>=a&&r(null));a+=1,n(t.value,t.key,A(function(e){a-=1,e?(r(e),u=!0):c()}))}}()}}function C(e){return function(t,n,r,i){return e(I(n),t,r,i)}}function T(e,t,n,r){r=p(r||d),t=t||[];var i=m(t)||g(t)?[]:{};e(t,function(e,t,r){n(e,function(e,n){i[t]=n,r(e)})},function(e){r(e,i)})}function N(e,t){return function(n,r,i){return e(n,t,r,i)}}function H(e){return l(function(t,r){var i;try{i=e.apply(this,t)}catch(o){return r(o)}n(i)&&"function"==typeof i.then?i.then(function(e){r(null,e)})["catch"](function(e){r(e.message?e:new Error(e))}):r(null,i)})}function U(e,t){for(var n=-1,r=e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function P(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),u=a.length;u--;){var c=a[e?u:++i];if(n(o[c],c,o)===!1)break}return t}}function R(e,t){return e&&Yn(e,t,$)}function W(){this.__data__=[]}function M(e,t){return e===t||e!==e&&t!==t}function z(e,t){for(var n=e.length;n--;)if(M(e[n][0],t))return n;return-1}function D(e){var t=this.__data__,n=z(t,e);if(0>n)return!1;var r=t.length-1;return n==r?t.pop():er.call(t,n,1),!0}function q(e){var t=this.__data__,n=z(t,e);return 0>n?void 0:t[n][1]}function B(e){return z(this.__data__,e)>-1}function F(e,t){var n=this.__data__,r=z(n,e);return 0>r?n.push([e,t]):n[r][1]=t,this}function V(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function G(){this.__data__=new V}function X(e){return this.__data__["delete"](e)}function Q(e){return this.__data__.get(e)}function J(e){return this.__data__.has(e)}function K(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(n){}return t}function Y(e){if(null!=e){try{return tr.call(e)}catch(t){}try{return e+""}catch(t){}}return""}function Z(e){if(!n(e))return!1;var t=r(e)||K(e)?ur:rr;return t.test(Y(e))}function ee(e,t){var n=e[t];return Z(n)?n:void 0}function te(){this.__data__=cr?cr(null):{}}function ne(e){return this.has(e)&&delete this.__data__[e]}function re(e){var t=this.__data__;if(cr){var n=t[e];return n===sr?void 0:n}return fr.call(t,e)?t[e]:void 0}function ie(e){var t=this.__data__;return cr?void 0!==t[e]:pr.call(t,e)}function oe(e,t){var n=this.__data__;return n[e]=cr&&void 0===t?hr:t,this}function ae(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ue(e){return e&&e.Object===Object?e:null}function ce(){this.__data__={hash:new ae,map:new(jr||V),string:new ae}}function se(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function le(e,t){var n=e.__data__;return se(t)?n["string"==typeof t?"string":"hash"]:n.map}function fe(e){return le(this,e)["delete"](e)}function de(e){return le(this,e).get(e)}function pe(e){return le(this,e).has(e)}function he(e,t){return le(this,e).set(e,t),this}function ve(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function me(e,t){var n=this.__data__;return n instanceof V&&n.__data__.length==Er&&(n=this.__data__=new ve(n.__data__)),n.set(e,t),this}function ge(e){this.__data__=new V(e)}function ye(e){return this.__data__.set(e,Or),this}function be(e){return this.__data__.has(e)}function we(e){var t=-1,n=e?e.length:0;for(this.__data__=new ve;++t<n;)this.add(e[t])}function _e(e,t){for(var n=-1,r=e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Se(e,t,n,r,i,o){var a=i&Lr,u=e.length,c=t.length;if(u!=c&&!(a&&c>u))return!1;var s=o.get(e);if(s)return s==t;var l=-1,f=!0,d=i&xr?new we:void 0;for(o.set(e,t);++l<u;){var p=e[l],h=t[l];if(r)var v=a?r(h,p,l,t,e,o):r(p,h,l,e,t,o);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!_e(t,function(e,t){return d.has(t)||p!==e&&!n(p,e,r,i,o)?void 0:d.add(t)})){f=!1;break}}else if(p!==h&&!n(p,h,r,i,o)){f=!1;break}}return o["delete"](e),f}function je(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function Ee(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function Oe(e,t,n,r,i,o,a){switch(n){case Dr:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case zr:return!(e.byteLength!=t.byteLength||!r(new kr(e),new kr(t)));case Cr:case Tr:return+e==+t;case Nr:return e.name==t.name&&e.message==t.message;case Ur:return e!=+e?t!=+t:e==+t;case Pr:case Wr:return e==t+"";case Hr:var u=je;case Rr:var c=o&Ir;if(u||(u=Ee),e.size!=t.size&&!c)return!1;var s=a.get(e);return s?s==t:(o|=Ar,a.set(e,t),Se(u(e),u(t),r,i,o,a));case Mr:if(Br)return Br.call(e)==Br.call(t)}return!1}function xe(e,t,n,r,i,o){var a=i&Fr,u=$(e),c=u.length,s=$(t),l=s.length;if(c!=l&&!a)return!1;for(var f=c;f--;){var d=u[f];if(!(a?d in t:b(t,d)))return!1}var p=o.get(e);if(p)return p==t;var h=!0;o.set(e,t);for(var v=a;++f<c;){d=u[f];var m=e[d],g=t[d];if(r)var y=a?r(g,m,d,t,e,o):r(m,g,d,e,t,o);if(!(void 0===y?m===g||n(m,g,r,i,o):y)){h=!1;break}v||(v="constructor"==d)}if(h&&!v){var w=e.constructor,_=t.constructor;w!=_&&"constructor"in e&&"constructor"in t&&!("function"==typeof w&&w instanceof w&&"function"==typeof _&&_ instanceof _)&&(h=!1)}return o["delete"](e),h}function Le(e){return ri.call(e)}function $e(e){return i(e)&&v(e.length)&&!!Ni[Ui.call(e)]}function ke(e,t,n,r,i,o){var a=Wn(e),u=Wn(t),c=Wi,s=Wi;a||(c=si(e),c=c==Ri?Mi:c),u||(s=si(t),s=s==Ri?Mi:s);var l=c==Mi&&!K(e),f=s==Mi&&!K(t),d=c==s;if(d&&!l)return o||(o=new ge),a||$e(e)?Se(e,t,n,r,i,o):Oe(e,t,c,n,r,i,o);if(!(i&Pi)){var p=l&&Di.call(e,"__wrapped__"),h=f&&Di.call(t,"__wrapped__");if(p||h){var v=p?e.value():e,m=h?t.value():t;return o||(o=new ge),n(v,m,r,i,o)}}return!!d&&(o||(o=new ge),xe(e,t,n,r,i,o))}function Ae(e,t,r,o,a){return e===t||(null==e||null==t||!n(e)&&!i(t)?e!==e&&t!==t:ke(e,t,Ae,r,o,a))}function Ie(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var u=n[i];if(a&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++i<o;){u=n[i];var c=u[0],s=e[c],l=u[1];if(a&&u[2]){if(void 0===s&&!(c in e))return!1}else{var f=new ge;if(r)var d=r(s,l,c,e,t,f);if(!(void 0===d?Ae(l,s,r,qi|Bi,f):d))return!1}}return!0}function Ce(e){return e===e&&!n(e)}function Te(e,t){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function Ne(e,t){return Te(t,function(t){return[t,e[t]]})}function He(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function Ue(e){return function(t){var n=si(t);return n==Fi?je(t):n==Vi?He(t):Ne(t,e(t))}}function Pe(e){for(var t=Gi(e),n=t.length;n--;)t[n][2]=Ce(t[n][1]);return t}function Re(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}function We(e){var t=Pe(e);return 1==t.length&&t[0][2]?Re(t[0][0],t[0][1]):function(n){return n===e||Ie(n,e,t)}}function Me(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError(Xi);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a),a};return n.cache=new(Me.Cache||ve),n}function ze(e){if("string"==typeof e)return e;if(o(e))return Yi?Yi.call(e):"";var t=e+"";return"0"==t&&1/e==-Ji?"-0":t}function De(e){return null==e?"":ze(e)}function qe(e){return Wn(e)?e:to(e)}function Be(e,t){if(Wn(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||(ro.test(e)||!no.test(e)||null!=t&&e in Object(t))}function Fe(e){if("string"==typeof e||o(e))return e;var t=e+"";return"0"==t&&1/e==-io?"-0":t}function Ve(e,t){t=Be(t,e)?[t]:qe(t);for(var n=0,r=t.length;null!=e&&r>n;)e=e[Fe(t[n++])];return n&&n==r?e:void 0}function Ge(e,t,n){var r=null==e?void 0:Ve(e,t);return void 0===r?n:r}function Xe(e,t){return t in Object(e)}function Qe(e,t,n){t=Be(t,e)?[t]:qe(t);for(var r,i=-1,o=t.length;++i<o;){var a=Fe(t[i]);if(!(r=null!=e&&n(e,a)))break;e=e[a]}if(r)return r;var o=e?e.length:0;return!!o&&v(o)&&x(a,o)&&(Wn(e)||E(e)||j(e))}function Je(e,t){return null!=e&&Qe(e,t,Xe)}function Ke(e,t){return Be(e)&&Ce(t)?Re(Fe(e),t):function(n){var r=Ge(n,e);return void 0===r&&r===t?Je(n,e):Ae(t,r,void 0,oo|ao)}}function Ye(e){return e}function Ze(e){return function(t){return Ve(t,e)}}function et(e){return Be(e)?h(Fe(e)):Ze(e)}function tt(e){return"function"==typeof e?e:null==e?Ye:"object"==typeof e?Wn(e)?Ke(e[0],e[1]):We(e):et(e)}function nt(e,t){return e&&R(e,tt(t,3))}function rt(e,t,n){for(var r=e.length,i=t+(n?0:-1);n?i--:++i<r;){var o=e[i];if(o!==o)return i}return-1}function it(e,t,n){if(t!==t)return rt(e,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}function ot(e,t,n){function r(e,t){b.push(function(){u(e,t)})}function i(){if(0===b.length&&0===m)return n(null,v);for(;b.length&&t>m;){var e=b.shift();e()}}function o(e,t){var n=y[e];n||(n=y[e]=[]),n.push(t)}function a(e){var t=y[e]||[];U(t,function(e){e()}),i()}function u(e,t){if(!g){var r=A(s(function(t,r){if(m--,r.length<=1&&(r=r[0]),t){var i={};nt(v,function(e,t){i[t]=e}),i[e]=r,g=!0,y=[],n(t,i)}else v[e]=r,a(e)}));m++;var i=t[t.length-1];t.length>1?i(v,r):i(r)}}function c(){for(var e,t=0;w.length;)e=w.pop(),t++,U(l(e),function(e){--_[e]||w.push(e)});if(t!==h)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function l(t){var n=[];return nt(e,function(e,r){Wn(e)&&it(e,t,0)>=0&&n.push(r)}),n}"function"==typeof t&&(n=t,t=null),n=p(n||d);var f=$(e),h=f.length;if(!h)return n(null);t||(t=h);var v={},m=0,g=!1,y={},b=[],w=[],_={};nt(e,function(t,n){if(!Wn(t))return r(n,[t]),void w.push(n);var i=t.slice(0,t.length-1),a=i.length;return 0===a?(r(n,t),void w.push(n)):(_[n]=a,void U(i,function(u){if(!e[u])throw new Error("async.auto task `"+n+"` has a non-existent dependency in "+i.join(", "));o(u,function(){a--,0===a&&r(n,t)})}))}),c(),i()}function at(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function ut(e,t,n){var r=-1,i=e.length;0>t&&(t=-t>i?0:i+t),n=n>i?i:n,0>n&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}function ct(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:ut(e,t,n)}function st(e,t){for(var n=e.length;n--&&it(t,e[n],0)>-1;);return n}function lt(e,t){for(var n=-1,r=e.length;++n<r&&it(t,e[n],0)>-1;);return n}function ft(e){return e.match(Oo)}function dt(e,t,n){if(e=De(e),e&&(n||void 0===t))return e.replace(xo,"");if(!e||!(t=ze(t)))return e;var r=ft(e),i=ft(t),o=lt(r,i),a=st(r,i)+1;return ct(r,o,a).join("")}function pt(e){return dt(e.toString().match(Lo)[2]).split(/\s*\,\s*/)}function ht(e,t){var n={};nt(e,function(e,t){function r(t,n){var r=Te(i,function(e){return t[e]});r.push(n),e.apply(null,r)}var i;if(Wn(e))i=at(e),e=i.pop(),n[t]=i.concat(i.length>0?r:e);else{if(0===e.length)throw new Error("autoInject task functions require explicit parameters.");1===e.length?n[t]=e:(i=pt(e),i.pop(),n[t]=i.concat(r))}}),ot(n,t)}function vt(e,t,n){function r(e,t,n,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");return e.started=!0,Wn(t)||(t=[t]),0===t.length&&e.idle()?ko(function(){e.drain()}):(U(t,function(t){var i={data:t,callback:r||d};n?e.tasks.unshift(i):e.tasks.push(i)}),void ko(e.process))}function i(e,t){return function(){o-=1;var n=!1,r=arguments;U(t,function(e){U(a,function(t,r){t!==e||n||(a.splice(r,1),n=!0)}),e.callback.apply(e,r)}),o<=e.concurrency-e.buffer&&e.unsaturated(),e.tasks.length+o===0&&e.drain(),e.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var o=0,a=[],u={tasks:[],concurrency:t,payload:n,saturated:d,unsaturated:d,buffer:t/4,empty:d,drain:d,started:!1,paused:!1,push:function(e,t){r(u,e,!1,t)},kill:function(){u.drain=d,u.tasks=[]},unshift:function(e,t){r(u,e,!0,t)},process:function(){for(;!u.paused&&o<u.concurrency&&u.tasks.length;){var t=u.payload?u.tasks.splice(0,u.payload):u.tasks.splice(0,u.tasks.length),n=Te(t,h("data"));0===u.tasks.length&&u.empty(),o+=1,a.push(t[0]),o===u.concurrency&&u.saturated();var r=A(i(u,t));e(n,r)}},length:function(){return u.tasks.length},running:function(){return o},workersList:function(){return a},idle:function(){return u.tasks.length+o===0},pause:function(){u.paused=!0},resume:function(){if(u.paused!==!1){u.paused=!1;for(var e=Math.min(u.concurrency,u.tasks.length),t=1;e>=t;t++)ko(u.process)}}};return u}function mt(e,t){return vt(e,1,t)}function gt(e,t,n,r){I(t)(e,n,r)}function yt(e,t,n,r){Ao(e,function(e,r,i){n(t,e,function(e,n){t=n,i(e)})},function(e){r(e,t)})}function bt(){var e=arguments;return s(function(t){var n=this,r=t[t.length-1];"function"==typeof r?t.pop():r=d,yt(e,t,function(e,t,r){t.apply(n,e.concat([s(function(e,t){r(e,t)})]))},function(e,t){r.apply(n,[e].concat(t))})})}function wt(){return bt.apply(null,Io.call(arguments))}function _t(e,t,n,r){var i=[];e(t,function(e,t,r){n(e,function(e,t){i=i.concat(t||[]),r(e)})},function(e){r(e,i)})}function St(e){return function(t,n,r){return e(Co,t,n,r)}}function jt(e){return function(t,n,r){return e(Ao,t,n,r)}}function Et(e,t,n){return function(r,i,o,a){function u(e){a&&(e?a(e):a(null,n(!1)))}function c(e,r,i){return a?void o(e,function(r,u){a&&(r?(a(r),a=o=!1):t(u)&&(a(null,n(!0,e)),a=o=!1)),i()}):i()}arguments.length>3?(a=a||d,e(r,i,c,u)):(a=o,a=a||d,o=i,e(r,c,u))}}function Ot(e,t){return t}function xt(e){return s(function(t,n){t.apply(null,n.concat([s(function(t,n){"object"==typeof console&&(t?console.error&&console.error(t):console[e]&&U(n,function(t){console[e](t)}))})]))})}function Lt(e,t,n){n=n||d;var r=s(function(t,r){t?n(t):(r.push(i),e.apply(this,r))}),i=function(e,i){return e?n(e):i?void t(r):n(null)};e(i)}function $t(e,t,n){var r=0;Lt(function(e){return r++<1?e(null,!0):void t.apply(this,arguments)},e,n)}function kt(e,t,n){if(n=n||d,!e())return n(null);var r=s(function(i,o){return i?n(i):e.apply(this,o)?t(r):void n.apply(null,[null].concat(o))});t(r)}function At(e,t,n){var r=0;return kt(function(){return++r<=1||t.apply(this,arguments)},e,n)}function It(e,t,n){return At(e,function(){return!t.apply(this,arguments)},n)}function Ct(e){return function(t,n,r){return e(t,r)}}function Tt(e,t,n,r){return I(t)(e,Ct(n),r)}function Nt(e){return l(function(t,n){var r=!0;t.push(function(){var e=arguments;r?ko(function(){n.apply(null,e)}):n.apply(null,e)}),e.apply(this,t),r=!1})}function Ht(e){return!e}function Ut(e,t,n,r){var i=[];e(t,function(e,t,r){n(e,function(n,o){n?r(n):(o&&i.push({index:t,value:e}),r())})},function(e){e?r(e):r(null,Te(i.sort(function(e,t){return e.index-t.index}),h("value")))})}function Pt(e,t){function n(e){return e?r(e):void i(n)}var r=A(t||d),i=Nt(e);n()}function Rt(e){function t(n){function r(){return e.length&&e[n].apply(null,arguments),r.next()}return r.next=function(){return n<e.length-1?t(n+1):null},r}return t(0)}function Wt(e,t){return t in e}function Mt(e,t){var n=Object.create(null),r=Object.create(null);t=t||Ye;var i=l(function(i,o){var a=t.apply(null,i);Wt(n,a)?ko(function(){o.apply(null,n[a])}):Wt(r,a)?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([s(function(e){n[a]=e;var t=r[a];delete r[a];for(var i=0,o=t.length;o>i;i++)t[i].apply(null,e)})])))});return i.memo=n,i.unmemoized=e,i}function zt(e,t,n){n=n||d;var r=m(t)?[]:{};e(t,function(e,t,n){e(s(function(e,i){i.length<=1&&(i=i[0]),r[t]=i,n(e)}))},function(e){n(e,r)})}function Dt(e,t,n){return zt(I(t),e,n)}function qt(e,t){
return vt(function(t,n){e(t[0],n)},t,1)}function Bt(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,i=e.length-1;i>r;){var o=r+(i-r+1>>>1);n(t,e[o])>=0?r=o:i=o-1}return r}function i(e,t,i,o){if(null!=o&&"function"!=typeof o)throw new Error("task callback must be a function");return e.started=!0,Wn(t)||(t=[t]),0===t.length?ko(function(){e.drain()}):void U(t,function(t){var a={data:t,priority:i,callback:"function"==typeof o?o:d};e.tasks.splice(r(e.tasks,a,n)+1,0,a),ko(e.process)})}var o=qt(e,t);return o.push=function(e,t,n){i(o,e,t,n)},delete o.unshift,o}function Ft(e,t){return function(n,r){if(null==n)return n;if(!m(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=Object(n);(t?o--:++o<i)&&r(a[o],o,a)!==!1;);return n}}function Vt(e,t){var n=Wn(e)?U:Jo;return n(e,tt(t,3))}function Gt(e,t){return t=p(t||d),Wn(e)?e.length?void Vt(e,function(e){e(t)}):t():t(new TypeError("First argument to race must be an array of functions"))}function Xt(e,t,n,r){var i=Ko.call(e).reverse();yt(i,t,n,r)}function Qt(e){return l(function(t,n){return t.push(s(function(e,t){if(e)n(null,{error:e});else{var r=null;1===t.length?r=t[0]:t.length>1&&(r=t),n(null,{value:r})}})),e.apply(this,t)})}function Jt(e,t,n,r){Ut(e,t,function(e,t){n(e,function(e,n){e?t(e):t(null,!n)})},r)}function Kt(e){return e.map(Qt)}function Yt(e,t){return zt(Ao,e,t)}function Zt(e,t,n){function r(e,t){if("object"==typeof t)e.times=+t.times||a,e.interval=+t.interval||u;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");e.times=+t||a}}function i(e){return function(n){t(function(t,r){n(!t||e,{err:t,result:r})})}}function o(e){return function(t){setTimeout(function(){t(null)},e)}}var a=5,u=0,c={times:a,interval:u};if(arguments.length<3&&"function"==typeof e?(n=t||d,t=e):(r(c,e),n=n||d),"function"!=typeof t)throw new Error("Invalid arguments for async.retry");for(var s=[];c.times;){var l=!(c.times-=1);s.push(i(l)),!l&&c.interval>0&&s.push(o(c.interval))}Yt(s,function(e,t){t=t[t.length-1],n(t.err,t.result)})}function en(e,t){return t||(t=e,e=null),l(function(n,r){function i(e){t.apply(null,n.concat([e]))}e?Zt(e,i,r):Zt(i,r)})}function tn(e,t,n){function r(e,t){var n=e.criteria,r=t.criteria;return r>n?-1:n>r?1:0}Gn(e,function(e,n){t(e,function(t,r){return t?n(t):void n(null,{value:e,criteria:r})})},function(e,t){return e?n(e):void n(null,Te(t.sort(r),h("value")))})}function nn(e,t,n){function r(){u||(o.apply(null,arguments),clearTimeout(a))}function i(){var t=e.name||"anonymous",r=new Error('Callback function "'+t+'" timed out.');r.code="ETIMEDOUT",n&&(r.info=n),u=!0,o(r)}var o,a,u=!1;return l(function(n,u){o=u,a=setTimeout(i,t),e.apply(null,n.concat(r))})}function rn(e,t,n,r){for(var i=-1,o=oa(ia((t-e)/(n||1)),0),a=Array(o);o--;)a[r?o:++i]=e,e+=n;return a}function on(e,t,n,r){return Vn(rn(0,e,1),t,n,r)}function an(e,t,n,r){3===arguments.length&&(r=n,n=t,t=Wn(e)?[]:{}),Co(e,function(e,r,i){n(t,e,r,i)},function(e){r(e,t)})}function un(e){return function(){return(e.unmemoized||e).apply(null,arguments)}}function cn(e,t,n){return kt(function(){return!e.apply(this,arguments)},t,n)}function sn(e,t){function n(i){if(r===e.length)return t.apply(null,[null].concat(i));var o=A(s(function(e,r){return e?t.apply(null,[e].concat(r)):void n(r)}));i.push(o);var a=e[r++];a.apply(null,i)}if(t=p(t||d),!Wn(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var r=0;n([])}var ln="[object Function]",fn="[object GeneratorFunction]",dn=Object.prototype,pn=dn.toString,hn="[object Symbol]",vn=Object.prototype,mn=vn.toString,gn=NaN,yn=/^\s+|\s+$/g,bn=/^[-+]0x[0-9a-f]+$/i,wn=/^0b[01]+$/i,_n=/^0o[0-7]+$/i,Sn=parseInt,jn=1/0,En=1.7976931348623157e308,On="Expected a function",xn=Math.max,Ln=h("length"),$n=9007199254740991,kn="function"==typeof Symbol&&Symbol.iterator,An=Object.getPrototypeOf,In=Object.prototype,Cn=In.hasOwnProperty,Tn=Object.keys,Nn="[object Arguments]",Hn=Object.prototype,Un=Hn.hasOwnProperty,Pn=Hn.toString,Rn=Hn.propertyIsEnumerable,Wn=Array.isArray,Mn="[object String]",zn=Object.prototype,Dn=zn.toString,qn=9007199254740991,Bn=/^(?:0|[1-9]\d*)$/,Fn=Object.prototype,Vn=C(T),Gn=N(Vn,1/0),Xn=f(Gn),Qn=N(Vn,1),Jn=f(Qn),Kn=s(function(e,t){return s(function(n){return e.apply(null,t.concat(n))})}),Yn=P(),Zn=Array.prototype,er=Zn.splice;V.prototype.clear=W,V.prototype["delete"]=D,V.prototype.get=q,V.prototype.has=B,V.prototype.set=F;var tr=Function.prototype.toString,nr=/[\\^$.*+?()[\]{}|]/g,rr=/^\[object .+?Constructor\]$/,ir=Object.prototype,or=Function.prototype.toString,ar=ir.hasOwnProperty,ur=RegExp("^"+or.call(ar).replace(nr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cr=ee(Object,"create"),sr="__lodash_hash_undefined__",lr=Object.prototype,fr=lr.hasOwnProperty,dr=Object.prototype,pr=dr.hasOwnProperty,hr="__lodash_hash_undefined__";ae.prototype.clear=te,ae.prototype["delete"]=ne,ae.prototype.get=re,ae.prototype.has=ie,ae.prototype.set=oe;var vr={"function":!0,object:!0},mr=vr[typeof e]&&e&&!e.nodeType?e:void 0,gr=vr[typeof module]&&module&&!module.nodeType?module:void 0,yr=ue(mr&&gr&&"object"==typeof global&&global),br=ue(vr[typeof self]&&self),wr=ue(vr[typeof window]&&window),_r=ue(vr[typeof this]&&this),Sr=yr||wr!==(_r&&_r.window)&&wr||br||_r||Function("return this")(),jr=ee(Sr,"Map");ve.prototype.clear=ce,ve.prototype["delete"]=fe,ve.prototype.get=de,ve.prototype.has=pe,ve.prototype.set=he;var Er=200;ge.prototype.clear=G,ge.prototype["delete"]=X,ge.prototype.get=Q,ge.prototype.has=J,ge.prototype.set=me;var Or="__lodash_hash_undefined__";we.prototype.add=we.prototype.push=ye,we.prototype.has=be;var xr=1,Lr=2,$r=Sr.Symbol,kr=Sr.Uint8Array,Ar=1,Ir=2,Cr="[object Boolean]",Tr="[object Date]",Nr="[object Error]",Hr="[object Map]",Ur="[object Number]",Pr="[object RegExp]",Rr="[object Set]",Wr="[object String]",Mr="[object Symbol]",zr="[object ArrayBuffer]",Dr="[object DataView]",qr=$r?$r.prototype:void 0,Br=qr?qr.valueOf:void 0,Fr=2,Vr=ee(Sr,"DataView"),Gr=ee(Sr,"Promise"),Xr=ee(Sr,"Set"),Qr=ee(Sr,"WeakMap"),Jr="[object Map]",Kr="[object Object]",Yr="[object Promise]",Zr="[object Set]",ei="[object WeakMap]",ti="[object DataView]",ni=Object.prototype,ri=ni.toString,ii=Y(Vr),oi=Y(jr),ai=Y(Gr),ui=Y(Xr),ci=Y(Qr);(Vr&&Le(new Vr(new ArrayBuffer(1)))!=ti||jr&&Le(new jr)!=Jr||Gr&&Le(Gr.resolve())!=Yr||Xr&&Le(new Xr)!=Zr||Qr&&Le(new Qr)!=ei)&&(Le=function(e){var t=ri.call(e),n=t==Kr?e.constructor:void 0,r=n?Y(n):void 0;if(r)switch(r){case ii:return ti;case oi:return Jr;case ai:return Yr;case ui:return Zr;case ci:return ei}return t});var si=Le,li="[object Arguments]",fi="[object Array]",di="[object Boolean]",pi="[object Date]",hi="[object Error]",vi="[object Function]",mi="[object Map]",gi="[object Number]",yi="[object Object]",bi="[object RegExp]",wi="[object Set]",_i="[object String]",Si="[object WeakMap]",ji="[object ArrayBuffer]",Ei="[object DataView]",Oi="[object Float32Array]",xi="[object Float64Array]",Li="[object Int8Array]",$i="[object Int16Array]",ki="[object Int32Array]",Ai="[object Uint8Array]",Ii="[object Uint8ClampedArray]",Ci="[object Uint16Array]",Ti="[object Uint32Array]",Ni={};Ni[Oi]=Ni[xi]=Ni[Li]=Ni[$i]=Ni[ki]=Ni[Ai]=Ni[Ii]=Ni[Ci]=Ni[Ti]=!0,Ni[li]=Ni[fi]=Ni[ji]=Ni[di]=Ni[Ei]=Ni[pi]=Ni[hi]=Ni[vi]=Ni[mi]=Ni[gi]=Ni[yi]=Ni[bi]=Ni[wi]=Ni[_i]=Ni[Si]=!1;var Hi=Object.prototype,Ui=Hi.toString,Pi=2,Ri="[object Arguments]",Wi="[object Array]",Mi="[object Object]",zi=Object.prototype,Di=zi.hasOwnProperty,qi=1,Bi=2,Fi="[object Map]",Vi="[object Set]",Gi=Ue($),Xi="Expected a function";Me.Cache=ve;var Qi,Ji=1/0,Ki=$r?$r.prototype:void 0,Yi=Ki?Ki.toString:void 0,Zi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,eo=/\\(\\)?/g,to=Me(function(e){var t=[];return De(e).replace(Zi,function(e,n,r,i){t.push(r?i.replace(eo,"$1"):n||e)}),t}),no=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ro=/^\w*$/,io=1/0,oo=1,ao=2,uo="\\ud800-\\udfff",co="\\u0300-\\u036f\\ufe20-\\ufe23",so="\\u20d0-\\u20f0",lo="\\ufe0e\\ufe0f",fo="["+uo+"]",po="["+co+so+"]",ho="\\ud83c[\\udffb-\\udfff]",vo="(?:"+po+"|"+ho+")",mo="[^"+uo+"]",go="(?:\\ud83c[\\udde6-\\uddff]){2}",yo="[\\ud800-\\udbff][\\udc00-\\udfff]",bo="\\u200d",wo=vo+"?",_o="["+lo+"]?",So="(?:"+bo+"(?:"+[mo,go,yo].join("|")+")"+_o+wo+")*",jo=_o+wo+So,Eo="(?:"+[mo+po+"?",po,go,yo,fo].join("|")+")",Oo=RegExp(ho+"(?="+ho+")|"+Eo+jo,"g"),xo=/^\s+|\s+$/g,Lo=/^(function[^\(]*)?\(?\s*([^\)=]*)/m,$o="function"==typeof setImmediate&&setImmediate;Qi=$o?$o:"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:function(e){setTimeout(e,0)};var ko=s(function(e,t){Qi(function(){e.apply(null,t)})}),Ao=N(gt,1),Io=Array.prototype.reverse,Co=N(gt,1/0),To=St(_t),No=jt(_t),Ho=s(function(e){var t=[null].concat(e);return l(function(e,n){return n.apply(this,t)})}),Uo=Et(Co,Ye,Ot),Po=Et(gt,Ye,Ot),Ro=Et(Ao,Ye,Ot),Wo=xt("dir"),Mo=N(Tt,1/0),zo=N(Tt,1),Do=Et(gt,Ht,Ht),qo=N(Do,1/0),Bo=N(Do,1),Fo=C(Ut),Vo=N(Fo,1/0),Go=N(Fo,1),Xo=xt("log"),Qo=N(Dt,1/0),Jo=Ft(R),Ko=Array.prototype.slice,Yo=C(Jt),Zo=N(Yo,1/0),ea=N(Yo,1),ta=Et(gt,Boolean,Ye),na=N(ta,1/0),ra=N(ta,1),ia=Math.ceil,oa=Math.max,aa=N(on,1/0),ua=N(on,1),ca={applyEach:Xn,applyEachSeries:Jn,apply:Kn,asyncify:H,auto:ot,autoInject:ht,cargo:mt,compose:wt,concat:To,concatSeries:No,constant:Ho,detect:Uo,detectLimit:Po,detectSeries:Ro,dir:Wo,doDuring:$t,doUntil:It,doWhilst:At,during:Lt,each:Mo,eachLimit:Tt,eachOf:Co,eachOfLimit:gt,eachOfSeries:Ao,eachSeries:zo,ensureAsync:Nt,every:qo,everyLimit:Do,everySeries:Bo,filter:Vo,filterLimit:Fo,filterSeries:Go,forever:Pt,iterator:Rt,log:Xo,map:Gn,mapLimit:Vn,mapSeries:Qn,memoize:Mt,nextTick:ko,parallel:Qo,parallelLimit:Dt,priorityQueue:Bt,queue:qt,race:Gt,reduce:yt,reduceRight:Xt,reflect:Qt,reflectAll:Kt,reject:Zo,rejectLimit:Yo,rejectSeries:ea,retry:Zt,retryable:en,seq:bt,series:Yt,setImmediate:ko,some:na,someLimit:ta,someSeries:ra,sortBy:tn,timeout:nn,times:aa,timesLimit:on,timesSeries:ua,transform:an,unmemoize:un,until:cn,waterfall:sn,whilst:kt,all:qo,any:na,forEach:Mo,forEachSeries:zo,forEachLimit:Tt,forEachOf:Co,forEachOfSeries:Ao,forEachOfLimit:gt,inject:yt,foldl:yt,foldr:Xt,select:Vo,selectLimit:Fo,selectSeries:Go,wrapSync:H};e["default"]=ca,e.applyEach=Xn,e.applyEachSeries=Jn,e.apply=Kn,e.asyncify=H,e.auto=ot,e.autoInject=ht,e.cargo=mt,e.compose=wt,e.concat=To,e.concatSeries=No,e.constant=Ho,e.detect=Uo,e.detectLimit=Po,e.detectSeries=Ro,e.dir=Wo,e.doDuring=$t,e.doUntil=It,e.doWhilst=At,e.during=Lt,e.each=Mo,e.eachLimit=Tt,e.eachOf=Co,e.eachOfLimit=gt,e.eachOfSeries=Ao,e.eachSeries=zo,e.ensureAsync=Nt,e.every=qo,e.everyLimit=Do,e.everySeries=Bo,e.filter=Vo,e.filterLimit=Fo,e.filterSeries=Go,e.forever=Pt,e.iterator=Rt,e.log=Xo,e.map=Gn,e.mapLimit=Vn,e.mapSeries=Qn,e.memoize=Mt,e.nextTick=ko,e.parallel=Qo,e.parallelLimit=Dt,e.priorityQueue=Bt,e.queue=qt,e.race=Gt,e.reduce=yt,e.reduceRight=Xt,e.reflect=Qt,e.reflectAll=Kt,e.reject=Zo,e.rejectLimit=Yo,e.rejectSeries=ea,e.retry=Zt,e.retryable=en,e.seq=bt,e.series=Yt,e.setImmediate=ko,e.some=na,e.someLimit=ta,e.someSeries=ra,e.sortBy=tn,e.timeout=nn,e.times=aa,e.timesLimit=on,e.timesSeries=ua,e.transform=an,e.unmemoize=un,e.until=cn,e.waterfall=sn,e.whilst=kt,e.all=qo,e.allLimit=Do,e.allSeries=Bo,e.any=na,e.anyLimit=ta,e.anySeries=ra,e.find=Uo,e.findLimit=Po,e.findSeries=Ro,e.forEach=Mo,e.forEachSeries=zo,e.forEachLimit=Tt,e.forEachOf=Co,e.forEachOfSeries=Ao,e.forEachOfLimit=gt,e.inject=yt,e.foldl=yt,e.foldr=Xt,e.select=Vo,e.selectLimit=Fo,e.selectSeries=Go,e.wrapSync=H}),app.factory("live",["$http","$rootScope",function(e,t){var n={};return n.getCameras=function(t){e.get("/controller/live/cameras").success(t).error(function(){t(null)})},n.getLiveImage=function(t,n,r){e.get("/controller/live/"+t+"/"+n).success(function(e){r("data:image/jpeg;base64,"+e)}).error(function(e){r("/img/no_video.png")})},n}]),app.controller("livecontroller",["$scope","$rootScope","$window","live","device","$interval","$translate",function(e,t,n,r,i,o,a){e.selectedcamera=void 0,e.device=i,e.selectedcamera=void 0,r.getCameras(function(t){e.cameras=t;for(var n in e.cameras)e.cameras[n].forEach(function(e){r.getLiveImage(e.serverId,e.id,function(t){e.image=t})})}),e.playfullscreen=function(t,n){t?(console.log("Playfullscreen"),e.selectedcamera={site:t,camera:n},console.log(e.selectedcamera)):(e.selectedcamera=void 0,console.log(e.selectedcamera))}}]),app.directive("liveplayer",["live","$interval","device",function(e,t,n){return{restrict:"E",replace:!0,templateUrl:"/liveplayer",scope:{site:"=",camera:"=",pause:"=",playfullscreen:"&",fullscreen:"="},link:function(n,r,i){n.playing=void 0,n.togglelivefeed=function(){r.find(".big-playing-indicator").show().fadeOut(500),n.playing?(t.cancel(n.playing),n.playing=void 0):n.playing=t(function(){n.pause||e.getLiveImage(n.camera.serverId,n.camera.id,function(e){n.camera.image=e})},200)},n.fullscreen&&!n.playing&&n.togglelivefeed()}}}]),app.directive("liveimage",function(){return{restrict:"E",scope:{image:"="},replace:!0,template:'<canvas class="imagecanvas"/>',link:function(e,t,n){var r=t[0];r.setAttribute("width",800),r.setAttribute("height",600);function i(){var t=new Image;t.src=e.image,t.onload=function(){if(t&&t.naturalWidth&&t.naturalWidth>0&&t.naturalHeight>0){var e=r.getContext("2d");e.width=800,e.height=600;var n=e.width/t.naturalWidth,i=e.height/t.naturalHeight,o=Math.min(n,i),a=(e.width-t.naturalWidth*o)/2,u=(e.height-t.naturalHeight*o)/2;e.clearRect(0,0,r.width,r.height),e.drawImage(t,0,0,t.naturalWidth,t.naturalHeight,a,u,t.naturalWidth*o,t.naturalHeight*o)}}}e.$watch("image",function(e,t){i()})}}}),app.factory("logdb",["$http",function(e){var t={};return t.getLog=function(t,n){e.get("/log").then(t,n)},t.getOldLog=function(t,n){e.get("/log/old").then(t,n)},t}]),app.controller("logcontroller",["$scope","$rootScope","logdb","$translate",function(e,t,n,r){e.log="",n.getLog(function(t){e.log=t.data},function(t){e.sendnotification("Impossible de récupérer les fichiers log.",!1,1),e.logHttpError(t)}),e.oldLog=!1,n.getOldLog(function(t){e.oldLog=t.data},function(t){e.sendnotification("Impossible de récupérer les fichiers log.",!1,1),e.logHttpError(t)})}]),app.directive("logviewer",function(){return{restrict:"E",replace:!0,scope:{log:"=",oldlog:"="},templateUrl:"/logviewer",link:function(e,t,n){e.showOldLog=!1,e.$watch("log",function(){t.scrollTop(t[0].scrollHeight)}),e.$watch("oldLog",function(){console.log(e.oldLog)})}}}),app.controller("navbarcontroller",["$scope","$rootScope","$location","alarmevents","appstate","$translate",function(e,t,n,r,i,o){e.languages=["fr","en"],e.showLanguagePicker=!1,setTimeout(function(){e.currentLanguage=e.getCurrentLanguage()},0),e.currentpage=n.absUrl(),e.alarmcounter=i.getState("alarmcounter"),e.currentpage.indexOf("alarmview")>-1&&(e.alarmcounter=0,i.saveState("alarmcounter",0)),e.isActive=function(t){return e.currentpage.indexOf(t)>-1};t.$on("alarm_create",function(t){e.currentpage.indexOf("alarmview")===-1&&(e.alarmcounter+=1,localStorage.setItem("alarmcounter",e.alarmcounter))});e.$on("$destroy",function(){unbind()})}]),app.factory("serverdb",["$http","$rootScope",function(e,t){var n={};return n.getservers=function(t){e.get("/controller/servers").success(t).error(function(){t(null)})},n.deleteserver=function(t,n){e["delete"]("/controller/server/"+t).success(n).error(function(){n("Unable to delete server.")})},n.updateserver=function(t,n){e.put("/controller/server",t).success(n.bind(null,null)).error(function(){n("Unable to update the server.")})},n.addserver=function(t,n){e.post("/controller/server",t).success(n.bind(null,null)).error(function(e){console.dir(e),n("Unable to add the server.")})},n}]),app.controller("servercontroller",["$rootScope","$scope","$window","serverdb","alarmevents","device",function(e,t,n,r,i,o){t.newserver=void 0,t.currentserver=void 0,t.servers=[],t.device=o,t.selected=void 0,t.back=function(){n.location.href="/accountsettings"},r.getservers(function(e){t.servers=e}),t.initemptyserver=function(){t.resetserver(),t.newserver={address:"192.168.",port:4e3,username:"admin",password:"",description:""}},t.editserver=function(e){if(t.newserver=void 0,!t.currentserver||t.currentserver.id!==e){var n=t.servers.map(function(e){return e.id}).indexOf(e);t.currentserver=angular.copy(t.servers[n])}},t.resetserver=function(){t.currentserver=void 0},t.deleteserver=function(e){var i=t.servers.map(function(e){return e.id}).indexOf(e);i!==-1&&n.confirm("Voulez-vous vraiment supprimer le serveur "+t.servers[i].description+" ?")&&r.deleteserver(e,function(e){e||(t.sendnotification("Le serveur a été supprimé.",!0,1),t.servers.splice(i,1))})},t.commitcurrentserver=function(){r.updateserver(t.currentserver,function(e,n){if(e)t.sendnotification("Une erreur s'est produite.",!0,1);else{var r=t.servers.map(function(e){return e.id}).indexOf(t.currentserver.id);t.servers[r]=t.currentserver,t.resetserver()}})},t.commitnewserver=function(){r.addserver(t.newserver,function(e,n){t.sendnotification("Le serveur a été ajouté.",!0,1),e||(t.newserver=void 0,t.servers.push(n))})},t.getDisconnectedServers=function(){return t.servers?t.servers.filter(function(e){return!e.connected}):{}};var a=function(e,n){var r=t.servers.map(function(e){return e.id}).indexOf(n.id);if(r>=0)if(t.servers[r]=angular.copy(n),n.connected)t.sendnotification("Connexion au serveur "+t.servers[r].description+" ("+t.servers[r].address+") établie",!0,1e3);else{var i=t.servers.filter(function(e){return!e.connected});if(i.length>1){var o="Impossible de se connecter aux serveurs suivants : ";i.forEach(function(e,t){o+=e.description+" ("+e.address+")",t!==i.length-1&&(o+=", ")}),t.sendnotification(o,!1,1e3)}else t.sendnotification("Connexion au serveur "+t.servers[r].description+" ("+t.servers[r].address+") impossible",!1,1e3)}},u=e.$on("connection",a);t.$on("$destroy",u)}]),!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var n,r=document.createElement(e||"div");for(n in t)r[n]=t[n];return r}function t(e){for(var t=1,n=arguments.length;n>t;t++)e.appendChild(arguments[t]);return e}function n(e,t,n,r){var i=["opacity",t,~~(100*e),n,r].join("-"),o=.01+n/r*100,a=Math.max(1-(1-e)/t*(100-o),e),u=s.substring(0,s.indexOf("Animation")).toLowerCase(),c=u&&"-"+u+"-"||"";return d[i]||(l.insertRule("@"+c+"keyframes "+i+"{0%{opacity:"+a+"}"+o+"%{opacity:"+e+"}"+(o+.01)+"%{opacity:1}"+(o+t)%100+"%{opacity:"+e+"}100%{opacity:"+a+"}}",l.cssRules.length),d[i]=1),i}function r(e,t){var n,r,i=e.style;if(t=t.charAt(0).toUpperCase()+t.slice(1),void 0!==i[t])return t;for(r=0;r<f.length;r++)if(n=f[r]+t,void 0!==i[n])return n}function i(e,t){for(var n in t)e.style[r(e,n)||n]=t[n];return e}function o(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)void 0===e[r]&&(e[r]=n[r])}return e}function a(e,t){return"string"==typeof e?e:e[t%e.length]}function u(e){this.opts=o(e||{},u.defaults,p)}function c(){function n(t,n){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',n)}l.addRule(".spin-vml","behavior:url(#default#VML)"),u.prototype.lines=function(e,r){function o(){return i(n("group",{coordsize:l+" "+l,coordorigin:-s+" "+-s}),{width:l,height:l})}function u(e,u,c){t(d,t(i(o(),{rotation:360/r.lines*e+"deg",left:~~u}),t(i(n("roundrect",{arcsize:r.corners}),{width:s,height:r.scale*r.width,left:r.scale*r.radius,top:-r.scale*r.width>>1,filter:c}),n("fill",{color:a(r.color,e),opacity:r.opacity}),n("stroke",{opacity:0}))))}var c,s=r.scale*(r.length+r.width),l=2*r.scale*s,f=-(r.width+r.length)*r.scale*2+"px",d=i(o(),{position:"absolute",top:f,left:f});if(r.shadow)for(c=1;c<=r.lines;c++)u(c,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(c=1;c<=r.lines;c++)u(c);return t(e,d)},u.prototype.opacity=function(e,t,n,r){var i=e.firstChild;r=r.shadow&&r.lines||0,i&&t+r<i.childNodes.length&&(i=i.childNodes[t+r],i=i&&i.firstChild,i=i&&i.firstChild,i&&(i.opacity=n))}}var s,l,f=["webkit","Moz","ms","O"],d={},p={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};if(u.defaults={},o(u.prototype,{spin:function(t){this.stop();var n=this,r=n.opts,o=n.el=e(null,{className:r.className});if(i(o,{position:r.position,width:0,zIndex:r.zIndex,left:r.left,top:r.top}),t&&t.insertBefore(o,t.firstChild||null),o.setAttribute("role","progressbar"),n.lines(o,n.opts),!s){var a,u=0,c=(r.lines-1)*(1-r.direction)/2,l=r.fps,f=l/r.speed,d=(1-r.opacity)/(f*r.trail/100),p=f/r.lines;!function h(){u++;for(var e=0;e<r.lines;e++)a=Math.max(1-(u+(r.lines-e)*p)%f*d,r.opacity),n.opacity(o,e*r.direction+c,a,r);n.timeout=n.el&&setTimeout(h,~~(1e3/l))}()}return n},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(r,o){function u(t,n){return i(e(),{position:"absolute",width:o.scale*(o.length+o.width)+"px",height:o.scale*o.width+"px",background:t,boxShadow:n,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*l+o.rotate)+"deg) translate("+o.scale*o.radius+"px,0)",borderRadius:(o.corners*o.scale*o.width>>1)+"px"})}for(var c,l=0,f=(o.lines-1)*(1-o.direction)/2;l<o.lines;l++)c=i(e(),{position:"absolute",top:1+~(o.scale*o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:s&&n(o.opacity,o.trail,f+l*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&t(c,i(u("#000","0 0 4px #000"),{top:"2px"})),t(r,t(c,u(a(o.color,l),"0 0 1px rgba(0,0,0,.1)")));return r},opacity:function(e,t,n){t<e.childNodes.length&&(e.childNodes[t].style.opacity=n)}}),"undefined"!=typeof document){l=function(){var n=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],n),n.sheet||n.styleSheet}();var h=i(e("group"),{behavior:"url(#default#VML)"});!r(h,"transform")&&h.adj?c():s=r(h,"animation")}return u}),app.factory("userdb",["$http","$rootScope",function(e,t){var n={};return n.getUsers=function(t,n){e.get("/users").then(t,n)},n.getCurrentUser=function(t,n){e.get("/users/me").then(t,n)},n.updateUser=function(t,n,r){e.put("/users/"+t.id,t).then(n,r)},n.updateDisplayName=function(t,n,r){e.put("/users/me/displayname",{displayname:t}).then(n,r)},n.changePassword=function(t,n,r,i){e.put("/users/me/password",{oldPassword:t,newPassword:n}).then(r,i)},n.createUser=function(t,n,r){e.post("/users",t).then(n,r)},n.requestPasswordReset=function(t,n,r){e.post("/users/"+t+"/resetPassword").then(n,r)},n.deleteUser=function(t,n,r){e["delete"]("/users/"+t).then(n,r)},n}]),app.controller("usercontroller",["$scope","$window","$location","userdb",function(e,t,n,r){e.newuser=void 0,e.currentuser=void 0,e.users=[],e.device=device,e.back=function(){t.location.href="/accountsettings"},r.getUsers(function(t){e.users=t.data},function(t){e.logHttpError(t),e.sendnotification("Impossible d'obtenir la liste des utilisateurs",!1,1)}),r.getCurrentUser(function(t){e.user=t.data},function(t){e.logHttpError(t)}),e.initemptyuser=function(){e.resetuser(),e.newuser={login:"",displayname:"",type:0}},e.edituser=function(t){if(e.newuser=void 0,!e.currentuser||e.currentuser.id!==t){var n=e.users.map(function(e){return e.id}).indexOf(t);e.currentuser=angular.copy(e.users[n])}},e.resetuser=function(){e.currentuser=void 0},e.deleteuser=function(n){var i=e.users.map(function(e){return e.id}).indexOf(n);i!==-1&&t.confirm("Voulez-vous vraiment supprimer l'utilisateur "+e.users[i].login+" ?")&&r.deleteUser(n,function(t){e.users.splice(i,1),e.sendnotification("L'utilisateur a été supprimé.",!0,1)},function(t){e.sendnotification("Une erreur s'est produite lors de la suppression de l'utilisateur.",!1,1),e.logHttpError(t)})},e.resetpassword=function(n){var i=e.users.map(function(e){return e.id}).indexOf(n);i!==-1&&t.confirm("Voulez-vous vraiment réinitialiser le mot de passe de l'utilisateur "+e.users[i].login+" ?")&&r.requestPasswordReset(n,function(t){e.users[i].shouldChangePassword=1,e.sendnotification("Le mot de passe à été réinitialisé.",!0,1)},function(t){e.sendnotification("Une erreur s'est produite lors de la réinitialisation du mot de passe.",!1,1),e.logHttpError(t)})},e.commitcurrentuser=function(){r.updateUser(e.currentuser,function(t){var n=e.users.map(function(e){return e.id}).indexOf(e.currentuser.id);e.users[n]=e.currentuser,e.resetuser(),e.sendnotification("Les modifications ont été enregistrées",!0,1)},function(){e.sendnotification("Une erreur s'est produite lors de l'enregistrement des modifications.",!1,1),e.logHttpError(response)})},e.commitnewuser=function(){r.createUser(e.newuser,function(t){e.newuser=void 0,e.users.push(t.data),e.sendnotification("L'utilisateur a bien été ajouté",!0,1)},function(t){e.sendnotification("Une erreur s'est produite lors de l'ajout de l'utilisateur",!1,1),e.logHttpError(t)})}}]);